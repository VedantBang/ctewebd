<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Question 2</title>
	<style type="text/css">
		.code {
			font-family: monospace;
		}
		.button {
			background-color: black;
			color: white;
			padding: 3px;
			cursor: pointer;
		}
		.gray{
			color:  gray;
		}
		.green{
			color: green;
		}
		.red{
			color: red;
		}
	</style>
</head>
<body style='font-family: Garamond;'>
	<h1>HTTP Methods</h1>
	<ul>
		<li>These words usually indicate the type of action you want to perform on a resource on the internet.</li>
		<li>They do have certain specific meanings, and you are encouraged to read up more about them <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods" target="_blank">here</a>.</li>
	</ul>

	<h2>Question:</h2>
	<h4>Write code for a backend server, which can receive a request on the path <span class="code">'/mirror'</span>.</h4>
	<h4>The server should return a string as a response.</h4>
	<h4>The string should be reverse of the HTTP Method of the request.</h4>
	<h4>For example: if the request was a <span class="code">GET /mirror</span> then the server should return the string <span class='code'>'TEG'</span>.</h4>
	<h4>Similarly, return a <span class='code'>TSOP</span> for a POST request. There are many other methods, which I haven't written in this description.</h4>
	<h4>Check the browser console for errors if any.</h4>
	<h4>Make sure the code which handles CORS (from the previous problem) is implemented in your code for this problem too, otherwise you'll get a CORS error.</h4>

	<form>
		Server address 
		<input type="text" name="" id="address">
	</form>
	<div>
		<span class='button' onclick='check()'>Submit</span>
	</div>

	<h2>Objectives Checklist:</h2>
	<ul id='list'>
	</ul>

	<script type="text/javascript">
		function shuffleArray(array) {
    		for (var i = array.length - 1; i > 0; i--) {
        		var j = Math.floor(Math.random() * (i + 1));
        		var temp = array[i];
        		array[i] = array[j];
        		array[j] = temp;
    		}
		}

		let methods = ['GET','POST','PUT','DELETE','PATCH'];
		shuffleArray(methods);


		window.onload = function(){
			for(let x = 0; x < methods.length; x++){
				let li = document.createElement('li');
				li.id='o' + x;
				li.classList.add('gray');
				let text = document.createTextNode(methods[x] + ' /mirror');
				li.appendChild(text);
				document.getElementById('list').appendChild(li);
			}
		}

		function resetColors(){
			for(let x = 0; x < methods.length; x++){
				document.querySelector('#o'+x).classList.remove('red');
				document.querySelector('#o'+x).classList.remove('green');
				document.querySelector('#o'+x).classList.add('gray');
			}
		}

		async function check(){
			resetColors();
			const address = document.querySelector('#address').value;
			for(let x = 0; x < methods.length; x++){
				try{
					let res = await fetch(address + '/mirror', {
						method: methods[x]
					});
					let output = await res.text();
					output = output.split('').reverse().join('');
					document.querySelector('#o' + x).classList.remove('gray');
					if(output === methods[x]){
						document.querySelector('#o' + x).classList.add('green');
					} else {
						document.querySelector('#o' + x).classList.add('red');
					}
				}
				catch(err){
					console.log(err);
					document.querySelector('#o' + x).classList.remove('gray');
					document.querySelector('#o' + x).classList.add('red');
				}
				
			}
		}
	</script>

</body>
</html>